<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- 개별 카테고리 (item 목록이 카드형식으로 배치되어 있는 화면) -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/category-part.css">
    <link rel="stylesheet" href="/css/animation.css">
    <title></title>
    <script src="/js/category_list.js"></script>
</head>
<body>
<div id="wrap">
    <header>
        <div class="title-container">
            <button class="go-prev">&lt;</button>
        </div>
        <div class="top-button-container">
            <button class="turn-on-mic" title="https://www.flaticon.com/authors/dave-gandy"></button>
            <button class="go-cart" title="https://www.freepik.com"></button>
        </div>
    </header>
    <div class="mid-category">

    </div>
    <div class="small-category">
        <div class="cat-button-container">

        </div>
    </div>
    <button class="fold fold-btn">^</button>
    <div class="item-container">
        <button th:onclick="'javascript:goPrevPage(' + ${category} + ')'"
           class="item-btn item-prev-btn">
            &lt;
        </button>
<!--        <div class="item-row-container">-->
                <table class="table table-striped item-row-container" style="margin: 0;">
                    <tbody style="width: 490px; display: flex; flex-flow: row wrap;">
                    <tr class="item-card" th:each="item : ${item}" th:onclick="'javascript:goItemPage(' + ${item.id} + ')'"
                        style="width: 225px; margin: 10px;">
                        <td style="display: flex; justify-content: center; align-items: center;">
                            <img th:src="${item.item_img}" class="thumbnail-img" th:alt="${item.name}"></img>
                        </td>
                        <td>
                            <hr class="divide-img-info">
                        </td>
                        <td th:text="${item.name}" class="item-title"></td>
                        <td th:if="${item.item_price} != ${item.discount_price}" th:text="${item.item_price}원" class="origin-price">
                        </td>
                        <td th:text="${item.discount_price}" class="discount-price" style="margin: 0 20px 20px 20px">원</td>
                        <td th:if="${item.is_testable} == 1">
                            <button th:text="${item.is_testable}" class="go-test" ></button>
                        </td>
                    </tr>
                    </tbody>
                </table>
        <button th:onclick="'javascript:goNextPage(' + ${category} + ')'"
            class="item-btn item-next-btn">&gt;</button>
    </div>
</div>


<script th:inline="javascript">
    /*<![CDATA[*/

    /*[# th:each="tmp : ${item}"]*/
    noti(/*[[${tmp.name}]]*/, /*[[${tmp.item_price}]]*/);
    /*[/]*/

    /*]]>*/

    function noti(testValue, tmpValue){
        console.log(testValue, tmpValue);
    }


    const goItemPage = id => location.href = `/item/${id}`;

    // const URLSearch = new URLSearchParams(location.search);
    const checkFirstPage = page => (page <= 1);
    const checkLastPage = (page, length) => (Number(page) >= length);

    const goPrevPage = category => {
        if (checkFirstPage(Number(localStorage.getItem('page')))) {
            console.log('First Page!');
            alert('제일 첫 페이지입니다.');
        } else {
            // location.href = `/category/${category}?page=${Number(URLSearch.get('page')) - 1}`;
            fetch(`/category/${category}?page=${Number(localStorage.getItem('page')) - 1}`)
                .then(res => res.text())
                .then(data => {
                    const wrapContainer = document.getElementById('wrap');
                    const itemRowContainer = document.createElement('div');
                    itemRowContainer.classList += 'item-container';
                    let itemContainer = data.split('<div class="item-container">')[1].split('<script>')[0];
                    itemRowContainer.innerHTML = itemContainer;
                    console.log(itemContainer);
                    wrapContainer.removeChild(wrapContainer.lastElementChild);
                    wrapContainer.appendChild(itemRowContainer);
                })
                .catch(e => console.error(e));

            localStorage.setItem('page', Number(localStorage.getItem('page')) - 1);
        }
    }


    ////////////////////
    // 다음 버튼을 눌렀을 때 어떻게 할 것인지는 좀 나중에 생각..
    // """"""""""전체 페이지 수를 알아야""""""""""""""" 설정이 가능함
    // 아니면 그냥 맨뒤 페이지일 때 > 누르면 맨앞으로,
    // 맨앞 페이지일 떄 < 누르면 맨뒤로 가게 만들 수도 있긴 함
    ////////////////////

    //일단 보류..
    const goNextPage = category => {
        // if (checkLastPage(Number(URLSearch.get('page')))) {
        //     console.log('First Page!');
        //     alert('제일 마지막 페이지입니다.');
        // } else {
        //     location.href = `/category/${category}?page=${URLSearch.get('page')}`;
        // }
        // location.href = `/category/${category}?page=${Number(URLSearch.get('page')) + 1}`;
        fetch(`/category/${category}?page=${Number(localStorage.getItem('page')) + 1}`)
            .then(res => res.text())
            .then(data => {
                const wrapContainer = document.getElementById('wrap');
                const itemRowContainer = document.createElement('div');
                itemRowContainer.classList += 'item-container';
                let itemContainer = data.split('<div class="item-container">')[1].split('<script>')[0];
                itemRowContainer.innerHTML = itemContainer;
                console.log(itemContainer);
                wrapContainer.removeChild(wrapContainer.lastElementChild);
                wrapContainer.appendChild(itemRowContainer);

                // const itemRowContainer = document.querySelector('.item-row-container');
                // let rowContainer = data.split('<tbody')[1].split('</tbody>')[0];
                // rowContainer = '<tbody ' + rowContainer;
                // console.log(rowContainer);
                // itemRowContainer.innerHTML = rowContainer;
            })
            .catch(e => console.error(e));
        localStorage.setItem('page', Number(localStorage.getItem('page')) + 1);
    }
</script>


<script src='/js/category.js'></script>
<!--<script src='/js/getItem.js'></script>-->
</body>
</html>